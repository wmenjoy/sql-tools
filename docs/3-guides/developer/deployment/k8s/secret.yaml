apiVersion: v1
kind: Secret
metadata:
  name: audit-secrets
  namespace: sqlguard
  labels:
    app: sql-audit-service
    component: audit
type: Opaque
stringData:
  # PostgreSQL Credentials
  # IMPORTANT: Change these values before deploying to production!
  postgres.url: "jdbc:postgresql://postgres-primary.sqlguard.svc.cluster.local:5432/audit?sslmode=require&ssl=true"
  postgres.username: "audit_user"
  postgres.password: "CHANGE_ME_POSTGRES_PASSWORD"

  # ClickHouse Credentials
  # IMPORTANT: Change these values before deploying to production!
  clickhouse.url: "jdbc:clickhouse://clickhouse.sqlguard.svc.cluster.local:8123/audit?ssl=true"
  clickhouse.username: "audit_user"
  clickhouse.password: "CHANGE_ME_CLICKHOUSE_PASSWORD"

  # JWT Configuration (if using OAuth2/JWT authentication)
  # IMPORTANT: Change these values before deploying to production!
  jwt.secret: "CHANGE_ME_JWT_SECRET_KEY_AT_LEAST_256_BITS_LONG"
  jwt.issuer.uri: "https://auth.example.com/oauth2/default"

  # Kafka SASL/SSL Configuration (if Kafka uses authentication)
  kafka.sasl.username: "audit_kafka_user"
  kafka.sasl.password: "CHANGE_ME_KAFKA_PASSWORD"
  kafka.sasl.mechanism: "SCRAM-SHA-512"

---
# TLS Certificate Secret (for Ingress HTTPS)
apiVersion: v1
kind: Secret
metadata:
  name: audit-tls
  namespace: sqlguard
  labels:
    app: sql-audit-service
    component: audit
type: kubernetes.io/tls
data:
  # IMPORTANT: Replace with actual TLS certificate and key (base64 encoded)
  # Use cert-manager to automatically provision certificates from Let's Encrypt
  # Example:
  #   tls.crt: <base64 encoded certificate>
  #   tls.key: <base64 encoded private key>
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNwRENDQVl3Q0NRQy9xRnRKM3pGMmp6QU5CZ2txaGtpRzl3MEJBUXNGQURBVE1SRXdEd1lEVlFRRERBaHQKYVd4bFpHRjBZVEFlRncweU5UQXhNREV4TWpBd01EQmFGdzB5TmpBeE1ERXhNakF3TURCYapBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3FxM3puZHV3VkE2UVoKOGFkRStVYjVXdEY3NGI2LkF1dThLNApVMi9CNlVxd2JraGlCd0lEQVFBQgotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t

---
# Service Account for SQL Audit Service
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sql-audit-service
  namespace: sqlguard
  labels:
    app: sql-audit-service
    component: audit

---
# RBAC Role for SQL Audit Service
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: sql-audit-service
  namespace: sqlguard
  labels:
    app: sql-audit-service
    component: audit
rules:
- apiGroups: [""]
  resources: ["configmaps", "secrets"]
  verbs: ["get", "list", "watch"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["events"]
  verbs: ["create", "patch"]

---
# RBAC RoleBinding for SQL Audit Service
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: sql-audit-service
  namespace: sqlguard
  labels:
    app: sql-audit-service
    component: audit
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: sql-audit-service
subjects:
- kind: ServiceAccount
  name: sql-audit-service
  namespace: sqlguard
